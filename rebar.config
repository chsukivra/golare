{minimum_otp_vsn, "27"}.

{shell, [
    {config, "config/shell.config"},
    {apps, [golare, crashy]}
]}.

{erl_opts, [
    debug_info
]}.

{src_dirs, [{"src", [{recursive, true}]}]}.

{deps, [
    {uuid, "2.0.7", {pkg, uuid_erl}},
    {certifi, "2.15.0"},
    {gun, {git, "https://github.com/ninenines/gun.git", {tag, "2.2.0"}}}
]}.

{dialyzer, [
    {plt_extra_apps, [
        gun
    ]}
]}.

%% Plugins for rebar3
{project_plugins, [
    {erlfmt, "~>1.3"}
]}.

{erlfmt, [
    write,
    {files, [
        "rebar.config",
        "src/*.app.src",
        "src/**/{*.erl, *.hrl}",
        "test/**/{*.erl, *.hrl}",
        "config/*.config.src"
    ]},
    {exclude_files, ["config/vm.args.src"]}
]}.

{xref_checks, [
    undefined_function_calls,
    undefined_functions,
    locals_not_used,
    deprecated_function_calls,
    deprecated_functions
]}.

{profiles, [
    {test, [
        {erl_opts, [nowarn_export_all, warnings_as_errors]},
        {deps, [
            cowboy,
            meck
        ]},
        {overrides, [
            {override, cowboy, [
                {deps, [
                    {ct_helper,
                        {git, "https://github.com/ninenines/ct_helper.git", {branch, "master"}}},
                    {cowlib, "< 3.0.0"},
                    {ranch, "< 3.0.0"}
                ]}
            ]}
        ]},
        {cover_enabled, true},
        {cover_opts, [verbose]},
        {ct_opts, [{sys_config, "./test/test.config"}]},
        {extra_src_dirs, [{"test", [{recursive, true}]}]},
        {xref_extra_paths, ["test"]}
    ]}
]}.
